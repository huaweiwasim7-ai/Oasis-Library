<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Oasis Library — Ready</title>

  <!-- Tailwind + Font Awesome CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      --bg-dark: linear-gradient(180deg,#05060a,#071226);
      --bg-light: linear-gradient(180deg,#f7fbff,#eef6ff);
      --card-dark: rgba(255,255,255,0.02);
      --card-light: rgba(0,0,0,0.04);
      --muted-dark:#9fb3c3;
      --muted-light:#61717f;
      --text-dark:#e6eef6;
      --text-light:#061322;
      --brand-dark:#b794f4;
      --brand-light:#6d28d9;
    }
    /* default (dark) variables */
    :root { --bg:var(--bg-dark); --card:var(--card-dark); --muted:var(--muted-dark); --text:var(--text-dark); --brand:var(--brand-dark); }
    /* light-mode overrides applied when html.light-mode class present */
    html.light-mode { --bg:var(--bg-light); --card:var(--card-light); --muted:var(--muted-light); --text:var(--text-light); --brand:var(--brand-light); }

    body { background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .glass { background: var(--card); backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,0.03); }
    .card-img { aspect-ratio: 2/3; object-fit: cover; border-radius: 12px; width:100%; display:block; }
    .hero-stars { background-image: radial-gradient(rgba(255,255,255,0.015) 1px, transparent 1px); background-size: 20px 20px; }
    ::-webkit-scrollbar { height: 8px; width: 10px }
    ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 8px }

   /* panel colors now use theme-aware CSS variables */
:root {
  --panel-bg: #06111a;               /* dark panel */
  --panel-border: rgba(255,255,255,0.03);
  --panel-text: var(--text);
  --panel-hover: rgba(255,255,255,0.02);
  --social-bg: rgba(255,255,255,0.03);
}

/* light theme overrides */
html.light-mode {
  --panel-bg: #ffffff;
  --panel-border: rgba(0,0,0,0.06);
  --panel-text: var(--text);
  --panel-hover: rgba(0,0,0,0.04);
  --social-bg: rgba(0,0,0,0.04);
}

/* Slide-over panel */
.panel {
  position: fixed;
  right: 0;
  top: 0;
  height: 100vh;
  width: 340px;
  max-width: 92%;
  background: var(--panel-bg);
  color: var(--panel-text);
  box-shadow: -20px 0 40px rgba(0,0,0,0.6);
  transform: translateX(110%);
  transition: transform .28s ease, background-color .28s ease, color .28s ease;
  z-index: 70;
  padding: 20px;
  border-left: 1px solid var(--panel-border);
}

/* open state */
.panel.open { transform: translateX(0); }

/* hover and menu item */
.menu-item { display:flex; gap:12px; align-items:center; padding:12px 6px; border-radius:8px; cursor:pointer; }
.menu-item:hover { background: var(--panel-hover); }

/* social buttons */
.socials a { width:40px; height:40px; display:inline-grid; place-items:center; border-radius:8px; background: var(--social-bg); color:inherit; text-decoration:none; }

/* close button uses panel text color */
.close-btn { position:absolute; left:12px; top:12px; background:transparent; border:0; color: var(--panel-text); font-size:18px; cursor:pointer; }


    /* collapsible content base */
    .section-content { overflow:hidden; max-height:0; opacity:0; transition: max-height 320ms ease, opacity 260ms ease; display:block; }
    .section-content.open { opacity:1; }

    /* small responsive tweaks */
    @media (max-width:640px){
      .panel { width:92%; }
      .card-img{ border-radius:10px; }
    }
  </style>
</head>
<body class="antialiased">

  <!-- NAV -->
  <nav class="px-6 py-4 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div id="brandLogo" class="bg-violet-600 p-2 rounded-full shadow-md"><i class="fa-solid fa-book-open text-white"></i></div>
      <div id="brandText" class="text-2xl font-bold" style="color:var(--brand)">Oasis Library</div>
    </div>

    <div class="flex items-center gap-3 text-sm text-slate-300">
      <button id="menuBtn" class="p-2 rounded-full hover:bg-white/3" title="Menu" aria-label="Open menu">
        <i class="fa-solid fa-bars text-lg"></i>
      </button>
    </div>
  </nav>

  <!-- HERO -->
  <header class="relative">
    <div class="h-[44vh] md:h-[50vh] rounded-b-2xl overflow-hidden relative">
      <div style="background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.85));" class="absolute inset-0 z-10"></div>
      <img id="heroImg" src="hero2.jpg" alt="hero" class="w-full h-full object-cover brightness-50" />
      <div class="absolute inset-0 hero-stars z-20"></div>
      <div class="absolute inset-0 flex flex-col items-center justify-center px-6 z-30">
        <h1 class="text-3xl md:text-5xl font-extrabold text-center max-w-3xl leading-tight">What would you like to read today?</h1>

        <div class="mt-6 w-full max-w-2xl">
          <div class="flex items-center gap-3 glass p-3 rounded-full shadow-sm">
            <i class="fa-solid fa-magnifying-glass text-slate-300 ml-2"></i>
            <input id="globalSearch" class="bg-transparent outline-none flex-1 text-white placeholder:text-slate-300" placeholder="Search books, authors or tags..." />
            <button id="searchClear" class="text-sm px-3 py-2 rounded-full bg-white/6 hover:bg-white/8">Clear</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="px-6 py-8 max-w-7xl mx-auto">
    <section class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold">Recommended</h2>
    </section>

    <section id="grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-6"></section>

    <div id="loader" class="mt-8 flex justify-center items-center">
      <div class="w-10 h-10 rounded-full border-4 border-t-transparent border-white/10 animate-spin"></div>
    </div>

    <div class="mt-12 text-center text-slate-400">Made with ❤️ — scroll to load more books</div>
  </main>

  <!-- CARD TEMPLATE -->
  <template id="cardTpl">
    <div class="card group relative">
      <div class="overflow-hidden rounded-xl">
        <img class="card-img transition-transform duration-300 group-hover:scale-105" />
      </div>
      <div class="mt-3">
        <div class="font-semibold text-white" style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden"></div>
        <div class="text-sm text-slate-400 mt-2">Author • <span class="year"></span></div>
      </div>
      <div class="absolute right-3 top-3 p-2 rounded-full bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity">
        <i class="fa-solid fa-ellipsis-vertical"></i>
      </div>
    </div>
  </template>

  <!-- MENU OVERLAY -->
  <div id="menuOverlay" class="overlay" aria-hidden="true"></div>

  <!-- SLIDE-OVER PANEL with collapsible Settings & About -->
  <aside id="menuPanel" class="panel" aria-hidden="true" role="dialog" aria-label="Site menu">
    <button id="closeMenu" class="close-btn" title="Close menu"><i class="fa-solid fa-xmark"></i></button>
    <div class="brand">
      <div class="bg-violet-600 p-2 rounded-full"><i class="fa-solid fa-book-open text-white"></i></div>
      <div>Oasis Library</div>
    </div>

    <nav style="margin-top:18px">
      <div class="menu-item" id="menuSettingsBtn" aria-expanded="false" role="button" tabindex="0">
        <i class="fa-solid fa-gear text-slate-300"></i>
        <div>
          <div style="font-weight:600">Settings</div>
          <div style="font-size:12px;color:var(--muted)">Appearance & preferences</div>
        </div>
        <div style="margin-left:auto;color:var(--muted);"><i class="fa-solid fa-chevron-down"></i></div>
      </div>

      <div class="section-content" id="settingsContent" aria-hidden="true" style="padding:8px 6px 14px 44px;">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div style="display:flex;gap:10px;align-items:center;">
            <div id="themeIcon" style="width:36px;height:36px;border-radius:8px;display:grid;place-items:center;background:rgba(255,255,255,0.03)">
              <i class="fa-solid fa-moon"></i>
            </div>
            <div>
              <div style="font-weight:600">Theme</div>
              <div style="font-size:12px;color:var(--muted)">Switch day / night mode</div>
            </div>
          </div>
          <button id="settingsThemeToggle" class="px-3 py-2 rounded bg-white/6">Toggle</button>
        </div>
      </div>

      <div class="menu-item" id="menuAboutBtn" aria-expanded="false" role="button" tabindex="0">
        <i class="fa-regular fa-circle-question text-slate-300"></i>
        <div>
          <div style="font-weight:600">About & FAQ</div>
          <div style="font-size:12px;color:var(--muted)">Learn about the project</div>
        </div>
        <div style="margin-left:auto;color:var(--muted);"><i class="fa-solid fa-chevron-down"></i></div>
      </div>

      <div class="section-content" id="aboutContent" aria-hidden="true" style="padding:8px 6px 14px 44px;">
        <div style="font-size:13px;color:var(--muted);margin-bottom:8px">About text (editable)</div>
        <textarea id="aboutTextInline" style="width:100%;height:120px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button id="saveAboutInline" class="px-3 py-2 rounded bg-white/6">Save</button>
          <button id="genAboutInline" class="px-3 py-2 rounded bg-white/6">Generate</button>
        </div>

        <hr style="border-color:rgba(255,255,255,0.03);margin:12px 0">

        <div>
          <h4 style="font-weight:600">FAQ</h4>
          <div style="font-size:14px;color:var(--muted);margin-top:8px">
            <strong>Q:</strong> How do I add books?<br>
            <strong>A:</strong> This demo shows covers via Google Books. Uploads/storage can be added later.<br><br>
            <strong>Q:</strong> Is this free?<br>
            <strong>A:</strong> The demo uses free APIs and local storage for settings.
          </div>
        </div>
      </div>

      <div class="menu-item" id="menuDonateBtn">
        <i class="fa-solid fa-hand-holding-dollar text-slate-300"></i>
        <div>
          <div style="font-weight:600">Donate</div>
          <div style="font-size:12px;color:var(--muted)">Support development</div>
        </div>
      </div>
    </nav>

    <hr style="border-color:rgba(255,255,255,0.03);margin:16px 0">

    <div style="font-size:13px;color:var(--muted);margin-bottom:8px">Follow us</div>
    <div class="socials" id="socialsList">
      <a id="socialInsta" href="#" target="_blank" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
      <a id="socialTwitter" href="#" target="_blank" title="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
      <a id="socialGithub" href="#" target="_blank" title="GitHub"><i class="fa-brands fa-github"></i></a>
      <a id="socialLinkedin" href="#" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
    </div>

    <div style="position:absolute;left:20px;bottom:18px;font-size:12px;color:#8b98a6">© Oasis Library</div>
  </aside>

  <!-- MAIN JS -->
  <script>
  /***** CONFIG - replace these with your real links *****/
  const PAYMENT_URL = 'upi://pay?pa=huaweiwasim7@okhdfcbank&pn=wasim%20Akram&aid=uGICAgMCj9_jLOw'; // <-- put your gateway or custom payment URL here
  const SOCIAL_URLS = {
    instagram: 'https://instagram.com/akmisaw',
    twitter: 'https://twitter.com',
    github: 'https://github.com/huaweiwasim7-ai',
    linkedin: 'https://linkedin.com/in/wasim-akram-4894071b0'
  };

  /***** Set social links *****/
  document.getElementById('socialInsta').href = SOCIAL_URLS.instagram;
  document.getElementById('socialTwitter').href = SOCIAL_URLS.twitter;
  document.getElementById('socialGithub').href = SOCIAL_URLS.github;
  document.getElementById('socialLinkedin').href = SOCIAL_URLS.linkedin;

  /***** Slide-over open/close logic *****/
  const menuBtn = document.getElementById('menuBtn');
  const menuPanel = document.getElementById('menuPanel');
  const menuOverlay = document.getElementById('menuOverlay');
  const closeMenu = document.getElementById('closeMenu');

  function openMenu(){
    menuPanel.classList.add('open');
    menuOverlay.style.display='block';
    menuPanel.setAttribute('aria-hidden','false');
    menuOverlay.setAttribute('aria-hidden','false');
    document.body.style.overflow='hidden';
  }
  function hideMenu(){
    menuPanel.classList.remove('open');
    menuOverlay.style.display='none';
    menuPanel.setAttribute('aria-hidden','true');
    menuOverlay.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
    // collapse sections
    collapseSection(settingsContent);
    collapseSection(aboutContent);
  }
  menuBtn?.addEventListener('click', openMenu);
  closeMenu?.addEventListener('click', hideMenu);
  menuOverlay?.addEventListener('click', hideMenu);
  document.addEventListener('keydown', e=> { if(e.key === 'Escape') hideMenu(); });

  /***** Collapsible sections logic (Settings & About) *****/
  const settingsBtn = document.getElementById('menuSettingsBtn');
  const aboutBtn = document.getElementById('menuAboutBtn');
  const settingsContent = document.getElementById('settingsContent');
  const aboutContent = document.getElementById('aboutContent');

  // ensure proper base styles (already in CSS) but set initial
  [settingsContent, aboutContent].forEach(el=>{
    el.style.maxHeight = '0px';
    el.style.opacity = '0';
    el.style.overflow = 'hidden';
  });

  function expandSection(el){
    // collapse other
    [settingsContent, aboutContent].forEach(s => { if(s !== el) collapseSection(s); });
    el.classList.add('open');
    el.style.display = 'block';
    // measure and expand
    const natural = el.scrollHeight + 20;
    requestAnimationFrame(()=> {
      el.style.maxHeight = natural + 'px';
      el.style.opacity = '1';
      el.setAttribute('aria-hidden','false');
    });
  }
  function collapseSection(el){
    if(!el) return;
    el.style.maxHeight = '0px';
    el.style.opacity = '0';
    el.setAttribute('aria-hidden','true');
    // keep display:block to allow transitions; optional hide later
    setTimeout(()=> { /* no-op */ }, 320);
    el.classList.remove('open');
  }

  settingsBtn?.addEventListener('click', ()=>{
    const expanded = settingsBtn.getAttribute('aria-expanded') === 'true';
    settingsBtn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
    if(!expanded) expandSection(settingsContent); else collapseSection(settingsContent);
  });

  aboutBtn?.addEventListener('click', ()=>{
    const expanded = aboutBtn.getAttribute('aria-expanded') === 'true';
    aboutBtn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
    if(!expanded) expandSection(aboutContent); else collapseSection(aboutContent);
  });

  /***** THEME / Settings (toggle persists) *****/
  const themeToggleBtn = document.getElementById('settingsThemeToggle');
  const themeIcon = document.getElementById('themeIcon');

  function applyTheme(name){
    if(name === 'light'){
      document.documentElement.classList.add('light-mode');
      localStorage.setItem('oasis_theme','light');
      themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
      themeToggleBtn.textContent = 'Light';
    } else {
      document.documentElement.classList.remove('light-mode');
      localStorage.setItem('oasis_theme','dark');
      themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
      themeToggleBtn.textContent = 'Dark';
    }
  }
  const savedTheme = localStorage.getItem('oasis_theme') || 'dark';
  applyTheme(savedTheme);

  themeToggleBtn.addEventListener('click', ()=>{
    const now = localStorage.getItem('oasis_theme') === 'light' ? 'dark' : 'light';
    applyTheme(now);
  });

  /***** ABOUT inline editor handlers *****/
  const aboutTextInline = document.getElementById('aboutTextInline');
  const saveAboutInline = document.getElementById('saveAboutInline');
  const genAboutInline = document.getElementById('genAboutInline');

  const defaultAbout = `Oasis Library is a lightweight, privacy-first digital bookshelf. We aggregate cover art and details using Google Books and provide a clean interface for readers to discover new titles. This demo is built for speed and simplicity.`;

  aboutTextInline.value = localStorage.getItem('oasis_about') || defaultAbout;

  saveAboutInline.addEventListener('click', ()=>{
    localStorage.setItem('oasis_about', aboutTextInline.value);
    saveAboutInline.textContent = 'Saved';
    setTimeout(()=> saveAboutInline.textContent = 'Save', 1200);
  });

  genAboutInline.addEventListener('click', ()=>{
    aboutTextInline.value = defaultAbout;
    genAboutInline.textContent = 'Generated';
    setTimeout(()=> genAboutInline.textContent = 'Generate', 900);
  });

  /***** Donate handler *****/
  document.getElementById('menuDonateBtn').addEventListener('click', ()=>{
    hideMenu();
    window.open(PAYMENT_URL, '_blank');
  });

  /***** GOOGLE BOOKS LOADER (infinite scroll + search) *****/
  const grid = document.getElementById('grid');
  const tpl = document.getElementById('cardTpl').content;
  const loaderEl = document.getElementById('loader');
  const searchInput = document.getElementById('globalSearch');
  const searchClear = document.getElementById('searchClear');

  let startIndex = 0;
  const PAGE_SIZE = 20;
  let q = '';
  let loading = false;
  let exhausted = false;
  let totalItems = Infinity;
  const fetchedIds = new Set();

  function gbCoverFromVolume(v){
    const links = v.volumeInfo && v.volumeInfo.imageLinks;
    if(links){
      return (links.thumbnail || links.smallThumbnail).replace(/^http:/, 'https:');
    }
    return 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="600"><rect width="100%" height="100%" fill="%23111"/><text x="50%" y="50%" fill="%23aaa" font-size="20" font-family="Arial" text-anchor="middle">No Cover</text></svg>';
  }

  function renderBook(book){
    const node = tpl.cloneNode(true);
    const card = node.querySelector('.card');
    const img = node.querySelector('img.card-img');
    img.src = book.cover;
    img.alt = book.title;
    node.querySelector('.font-semibold').textContent = book.title;
    node.querySelector('.year').textContent = book.year || '';
    const meta = node.querySelector('.text-sm');
    meta.textContent = book.author ? (book.author + ' • ') : '';
    meta.appendChild(document.createTextNode(book.year || ''));
    card.addEventListener('click', ()=> {
      if(book.infoLink) window.open(book.infoLink, '_blank');
      else alert(book.title + '\n' + (book.author || ''));
    });
    grid.appendChild(node);
  }

  async function fetchBooksFromGoogle(start, query){
    const base = 'https://www.googleapis.com/books/v1/volumes';
    const params = new URLSearchParams();
    params.set('q', query || 'subject:fiction');
    params.set('startIndex', start);
    params.set('maxResults', PAGE_SIZE);
    const url = base + '?' + params.toString();
    const res = await fetch(url);
    if(!res.ok) throw new Error('Google Books fetch failed: ' + res.status);
    return res.json();
  }

  async function loadMore(){
    if(loading || exhausted) return;
    if(startIndex >= totalItems) { exhausted = true; loaderEl.style.display='none'; return; }
    loading = true;
    loaderEl.style.display = 'flex';
    try{
      const data = await fetchBooksFromGoogle(startIndex, q);
      totalItems = data.totalItems || 0;
      const items = data.items || [];
      let added = 0;
      for(const it of items){
        const unique = it.id || (it.volumeInfo && it.volumeInfo.title) || (Math.random()+'');
        if(fetchedIds.has(unique)) continue;
        fetchedIds.add(unique);
        const book = {
          id: unique,
          title: it.volumeInfo?.title || 'Untitled',
          author: (it.volumeInfo?.authors && it.volumeInfo.authors[0]) || '',
          year: it.volumeInfo?.publishedDate ? it.volumeInfo.publishedDate.split('-')[0] : '',
          cover: gbCoverFromVolume(it),
          infoLink: it.volumeInfo?.infoLink || ''
        };
        renderBook(book);
        added++;
      }
      startIndex += PAGE_SIZE;
      if(startIndex >= Math.min(totalItems, 1000)) exhausted = true;
      if(items.length === 0) exhausted = true;
    }catch(err){
      console.error('Load error', err);
      exhausted = true;
    }finally{
      loading = false;
      loaderEl.style.display = exhausted ? 'none' : 'flex';
    }
  }

  /* initial load */
  loadMore();

  /* infinite scroll trigger */
  window.addEventListener('scroll', ()=>{
    const scrollPos = window.innerHeight + window.scrollY;
    const nearBottom = document.body.offsetHeight - 700;
    if(scrollPos > nearBottom) loadMore();
  }, { passive: true });

  /* search */
  let searchTimer = null;
  searchInput.addEventListener('input', (e)=>{
    clearTimeout(searchTimer);
    searchTimer = setTimeout(()=> {
      const val = e.target.value.trim();
      startSearch(val);
    }, 350);
  });
  searchClear.addEventListener('click', ()=>{ searchInput.value=''; startSearch(''); });

  function clearGrid(){
    grid.innerHTML = '';
    fetchedIds.clear();
    startIndex = 0;
    exhausted = false;
    totalItems = Infinity;
  }

  async function startSearch(val){
    q = val || '';
    clearGrid();
    loaderEl.style.display = 'flex';
    await loadMore();
  }

  searchInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { clearTimeout(searchTimer); startSearch(searchInput.value.trim()); } });

  </script>
</body>
</html>
